(()=>{"use strict";var t={m:{},u:t=>t+".js"};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var i=s.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=document.baseURI||self.location.href,(()=>{const e=class{metronome;audioContext;current16thNote;lookahead;scheduleAheadTime;nextNoteTime;noteLength;notesInQueue;gainNode;constructor(t,e){this.metronome=t,this.audioContext=e,this.current16thNote=0,this.lookahead=25,this.scheduleAheadTime=.1,this.nextNoteTime=0,this.noteLength=.05,this.notesInQueue=[],this.gainNode=this.audioContext.createGain()}nextNote(){const t=60/this.metronome.tempo;this.nextNoteTime+=.25*t,this.current16thNote+=1,this.current16thNote>=this.metronome.againstBeat*this.metronome.baseBeat&&(this.current16thNote=0)}scheduleNote(t,e){if(this.notesInQueue.push({note:t,time:e}),t%this.metronome.baseBeat!=0&&t%this.metronome.againstBeat!=0)return;const s=this.audioContext.createOscillator();s.connect(this.gainNode).connect(this.audioContext.destination),t%(this.metronome.againstBeat*this.metronome.baseBeat)==0?s.frequency.value=880:t%this.metronome.againstBeat==0?s.frequency.value=220:t%this.metronome.baseBeat==0&&(s.frequency.value=440),s.start(e),s.stop(e+this.noteLength)}scheduler(){for(;this.nextNoteTime<this.audioContext.currentTime+this.scheduleAheadTime;)this.scheduleNote(this.current16thNote,this.nextNoteTime),this.nextNote()}},s="Sound: ON",i="Play",a="Stop";const n=class{engine;soundButton;playButton;isSoundMuted;onPlay;onPause;constructor(t){this.engine=t,this.soundButton=document.querySelector(".controllers__sound"),this.playButton=document.querySelector(".controllers__play"),this.isSoundMuted=!0,this.playButton.addEventListener("click",(()=>{this.playButton.innerHTML===i?(this.playButton.innerHTML=a,this.soundButton.innerHTML=s,this.onPlay&&this.onPlay(),this.soundOn()):(this.playButton.innerHTML=i,this.soundButton.innerHTML="Sound: ",this.onPause&&this.onPause(),this.soundOff())})),this.soundButton.addEventListener("click",(()=>{this.playButton.innerHTML===a&&(!1===this.isSoundMuted?(this.soundButton.innerHTML=s,this.soundOn(),this.isSoundMuted=!0):(this.soundButton.innerHTML="Sound: OFF",this.soundOff(),this.isSoundMuted=!1))}))}setOnPlay(t){this.onPlay=t}setOnPause(t){this.onPause=t}soundOn(){this.engine.gainNode.gain.value=1}soundOff(){this.engine.gainNode.gain.value=0}};const o=class{warning;metronome;againstBeatPlus;againstBeatValue;againstBeatMinus;baseBeatPlus;baseBeatValue;baseBeatMinus;switchBeats;constructor(t,e){this.warning=t,this.metronome=e,this.againstBeatPlus=document.querySelector(".gui-controllers__against-beat.gui-controllers__beat-plus"),this.againstBeatValue=document.querySelector(".gui-controllers__against-beat.gui-controllers__beat-value"),this.againstBeatMinus=document.querySelector(".gui-controllers__against-beat.gui-controllers__beat-minus"),this.baseBeatPlus=document.querySelector(".gui-controllers__base-beat.gui-controllers__beat-plus"),this.baseBeatValue=document.querySelector(".gui-controllers__base-beat.gui-controllers__beat-value"),this.baseBeatMinus=document.querySelector(".gui-controllers__base-beat.gui-controllers__beat-minus"),this.switchBeats=document.querySelector(".gui-controllers__switch-beats"),this.againstBeatPlus.addEventListener("click",(()=>{this.metronome.againstBeat+=1,this.againstBeatValue.valueAsNumber+=1,this.warning.isPoly(this.metronome.againstBeat,this.metronome.baseBeat),this.checkBeatsLimits(this.metronome.againstBeat,"against")})),this.againstBeatMinus.addEventListener("click",(()=>{this.metronome.againstBeat-=1,this.againstBeatValue.valueAsNumber-=1,this.warning.isPoly(this.metronome.againstBeat,this.metronome.baseBeat),this.checkBeatsLimits(this.metronome.againstBeat,"against")})),this.againstBeatValue.addEventListener("change",(t=>{let e=t.target;this.metronome.againstBeat=e.valueAsNumber,this.againstBeatValue.valueAsNumber=e.valueAsNumber,this.warning.isPoly(this.metronome.againstBeat,this.metronome.baseBeat),this.checkBeatsLimits(e.valueAsNumber,"against")})),this.baseBeatPlus.addEventListener("click",(()=>{this.metronome.baseBeat+=1,this.baseBeatValue.valueAsNumber+=1,this.warning.isPoly(this.metronome.againstBeat,this.metronome.baseBeat),this.checkBeatsLimits(this.metronome.baseBeat,"base")})),this.baseBeatMinus.addEventListener("click",(()=>{this.metronome.baseBeat-=1,this.baseBeatValue.valueAsNumber-=1,this.warning.isPoly(this.metronome.againstBeat,this.metronome.baseBeat),this.checkBeatsLimits(this.metronome.baseBeat,"base")})),this.baseBeatValue.addEventListener("change",(t=>{let e=t.target;this.metronome.baseBeat=e.valueAsNumber,this.baseBeatValue.valueAsNumber=e.valueAsNumber,this.warning.isPoly(this.metronome.againstBeat,this.metronome.baseBeat),this.checkBeatsLimits(e.valueAsNumber,"base")})),this.switchBeats.addEventListener("click",(()=>{[this.metronome.againstBeat,this.metronome.baseBeat]=[this.metronome.baseBeat,this.metronome.againstBeat],[this.againstBeatValue.valueAsNumber,this.baseBeatValue.valueAsNumber]=[this.baseBeatValue.valueAsNumber,this.againstBeatValue.valueAsNumber]}))}checkBeatsLimits(t,e){t>9&&("against"===e?(this.metronome.againstBeat=9,this.againstBeatValue.valueAsNumber=9):(this.metronome.baseBeat=9,this.baseBeatValue.valueAsNumber=9)),t<=1&&("against"===e?(this.metronome.againstBeat=2,this.againstBeatValue.valueAsNumber=2):(this.metronome.baseBeat=2,this.baseBeatValue.valueAsNumber=2))}};const h=class{metronome;bpmMinusOne;bpmMinusFive;bpmPlusOne;bpmPlusFive;bpmValue;constructor(t){this.metronome=t,this.bpmMinusOne=document.querySelector(".gui-controllers__bpm.gui-controllers__bpm-minus--1"),this.bpmMinusFive=document.querySelector(".gui-controllers__bpm.gui-controllers__bpm-minus--5"),this.bpmPlusOne=document.querySelector(".gui-controllers__bpm.gui-controllers__bpm-plus--1"),this.bpmPlusFive=document.querySelector(".gui-controllers__bpm.gui-controllers__bpm-plus--5"),this.bpmValue=document.querySelector(".gui-controllers__bpm.gui-controllers__bpm-value--number"),this.bpmMinusOne.addEventListener("click",(()=>{this.metronome.tempo-=1,this.bpmValue.valueAsNumber-=1,this.checkBpmLimits()})),this.bpmMinusFive.addEventListener("click",(()=>{this.metronome.tempo-=5,this.bpmValue.valueAsNumber-=5,this.checkBpmLimits()})),this.bpmPlusOne.addEventListener("click",(()=>{this.metronome.tempo+=1,this.bpmValue.valueAsNumber+=1,this.checkBpmLimits()})),this.bpmPlusFive.addEventListener("click",(()=>{this.metronome.tempo+=5,this.bpmValue.valueAsNumber+=5,this.checkBpmLimits()})),this.bpmValue.addEventListener("change",(t=>{let e=t.target;this.metronome.tempo=e.valueAsNumber,this.bpmValue.valueAsNumber=e.valueAsNumber,this.checkBpmLimits()}))}checkBpmLimits(){this.metronome.tempo>300&&(this.metronome.tempo=300,this.bpmValue.valueAsNumber=300),this.metronome.tempo<=30&&(this.metronome.tempo=30,this.bpmValue.valueAsNumber=30)}},r="-selected";const m=class{options;selected;constructor(){this.options=document.querySelectorAll(".gui-container__tab"),this.selected="square",Array.from(this.options).forEach((t=>{t.addEventListener("click",(()=>{t.classList.contains(r)||(this.deselectAllTabs(),t.classList.add(r),this.selected=t.dataset.guiContainerTab)}))}))}deselectAllTabs(){Array.from(this.options).forEach((t=>{t.classList.remove(r)}))}},u="-show";const c=class{warning;constructor(){this.warning=document.querySelector(".gui-controllers__warning")}isPoly(t,e){let s=Number(t),i=Number(e);Math.max(s,i)%Math.min(s,i)==0?this.show():this.hide()}show(){this.warning.classList.add(u)}hide(){this.warning.classList.remove(u)}};const l=class{metronome;bpm;tapButton;newTap;lastTap;counterTap;differenceBetweenTaps;avgBPM;previousTap;elapsedTime;constructor(t,e){this.metronome=t,this.bpm=e,this.tapButton=document.querySelector(".gui-controllers__tap"),this.newTap=0,this.lastTap=0,this.counterTap=0,this.differenceBetweenTaps=0,this.avgBPM=0,this.previousTap=0,this.elapsedTime=0,this.tapButton.addEventListener("click",(()=>this.updateTempo()))}updateTempo(){0===this.lastTap&&(this.newTap=(new Date).getTime(),this.counterTap=0),this.lastTap=(new Date).getTime(),this.elapsedTime=(new Date).getTime()-this.previousTap,this.previousTap=this.lastTap,this.differenceBetweenTaps=this.lastTap-this.newTap,0!==this.differenceBetweenTaps?this.avgBPM=Math.round(6e4*this.counterTap/this.differenceBetweenTaps):this.avgBPM=30,this.counterTap+=1,this.metronome.tempo=this.avgBPM,this.bpm.bpmValue.valueAsNumber=this.metronome.tempo,this.elapsedTime>3e3&&(this.lastTap=0)}};const d=class{metronome;engine;tabSelection;warning;beats;bpm;tap;controllers;constructor(t,e){this.metronome=t,this.engine=e,this.tabSelection=new m,this.warning=new c,this.beats=new o(this.warning,this.metronome),this.bpm=new h(this.metronome),this.tap=new l(this.metronome,this.bpm),this.controllers=new n(this.engine)}};const g=class{againstBeat;baseBeat;tempo;constructor(t,e,s){this.againstBeat=t,this.baseBeat=e,this.tempo=s}},b="lightblue",p=2*Math.PI;const v=class{canvas;canvasContext;metronome;size;index;beatType;currentNote;type;constructor(t,e,s,i,a,n,o){this.canvas=t,this.canvasContext=e,this.metronome=s,this.index=i,this.beatType=a,this.type=n,this.currentNote=o}resize(){window.innerWidth>=B&&window.innerWidth<w?this.size=16:window.innerWidth>=w&&window.innerWidth<y?this.size=20:this.size=32}createShape(){let t,e,s,i,a,n,o,h,r,m,u,c;switch(this.resize(),"against"===this.beatType?(t=this.canvas.width/this.metronome.againstBeat-this.size,s=0,u=this.size,n=this.canvas.width/this.metronome.againstBeat*this.index,o=0,r=this.canvas.width/this.metronome.againstBeat):(t=this.canvas.width/this.metronome.baseBeat-this.size,s=this.canvas.height-2*this.size,u=this.canvas.height-this.size,n=this.canvas.width/this.metronome.baseBeat*this.index,o=this.canvas.height/2,r=this.canvas.width/this.metronome.baseBeat),this.type){case"square":e=(this.size+t)*this.index,a=2*this.size,i=a,this.canvasContext.fillRect(e,s,a,i),this.canvasContext.fill();break;case"pipelines":e=(this.size+t)*this.index,a=this.size/2,i=2*this.size,this.canvasContext.fillRect(e,s,a,i),this.canvasContext.fill();break;case"grid":h=this.canvas.height/2,this.canvasContext.beginPath(),this.canvasContext.rect(n,o,r,h),this.canvasContext.strokeStyle="black",this.canvasContext.fill(),this.canvasContext.stroke();break;case"dots":m=(this.size+t)*this.index+this.size,c=this.size,this.canvasContext.beginPath(),this.canvasContext.arc(m,u,c,0,p),this.canvasContext.fill()}}renderShape(){this.canvasContext.fillStyle="lightgray",this.createShape()}animateShape(){let t;t="against"===this.beatType?this.metronome.baseBeat:this.metronome.againstBeat,this.currentNote%t==0?this.canvasContext.fillStyle=this.currentNote/t===this.index?"blue":b:this.canvasContext.fillStyle=b,this.createShape()}},B=0,w=700,y=1e3;const N=class{metronome;engine;view;audioContext;animation;currentNote;againstBeatSquare;baseBeatSquare;canvas;canvasContext;constructor(t,e,s,i){this.metronome=t,this.engine=e,this.view=s,this.audioContext=i,this.canvas=document.querySelector("canvas"),this.canvasContext=this.canvas.getContext("2d"),this.animation=0,this.currentNote=0,this.resizeCanvas(),window.addEventListener("resize",(()=>this.resizeCanvas()))}reset(){this.canvasContext.reset(),window.cancelAnimationFrame(this.animation)}render(){this.reset(),this.animation=window.requestAnimationFrame((()=>this.render()));for(let t=0;t<this.metronome.againstBeat;t+=1)this.againstBeatSquare=new v(this.canvas,this.canvasContext,this.metronome,t,"against",this.view.tabSelection.selected),this.againstBeatSquare.renderShape();for(let t=0;t<this.metronome.baseBeat;t+=1)this.baseBeatSquare=new v(this.canvas,this.canvasContext,this.metronome,t,"base",this.view.tabSelection.selected),this.baseBeatSquare.renderShape()}playAnimation(){for(this.reset(),this.animation=window.requestAnimationFrame((()=>this.playAnimation()));this.engine.notesInQueue.length&&this.engine.notesInQueue[0].time<this.audioContext.currentTime;)this.currentNote=this.engine.notesInQueue[0].note,this.engine.notesInQueue.splice(0,1);for(let t=0;t<this.metronome.againstBeat;t++)this.againstBeatSquare=new v(this.canvas,this.canvasContext,this.metronome,t,"against",this.view.tabSelection.selected,this.currentNote),this.againstBeatSquare.animateShape();for(let t=0;t<this.metronome.baseBeat;t+=1)this.baseBeatSquare=new v(this.canvas,this.canvasContext,this.metronome,t,"base",this.view.tabSelection.selected,this.currentNote),this.baseBeatSquare.animateShape()}stopAnimation(){window.cancelAnimationFrame(this.animation),this.render()}resizeCanvas(){window.innerWidth>=B&&window.innerWidth<w?(this.canvas.width=350,this.canvas.height=100):window.innerWidth>=w&&window.innerWidth<y?(this.canvas.width=450,this.canvas.height=100):(this.canvas.width=600,this.canvas.height=150)}};class T{isPlaying;metronome;engine;view;audioContext;timerWorker;canvas;constructor(){this.isPlaying=!1,this.metronome=new g(3,4,120),this.audioContext=new AudioContext,this.engine=new e(this.metronome,this.audioContext),this.view=new d(this.metronome,this.engine),this.canvas=new N(this.metronome,this.engine,this.view,this.audioContext),this.init()}init(){this.view.controllers.setOnPlay((()=>{S.play(),this.canvas.playAnimation()})),this.view.controllers.setOnPause((()=>{S.pause(),this.canvas.stopAnimation()})),this.timerWorker=new Worker(new URL(t.p+t.u(295),t.b)),this.canvas.render(),this.timerWorker.onmessage=t=>"tick"===t.data?this.engine.scheduler():console.log(`message: ${t.data}`),this.timerWorker.postMessage({interval:this.engine.lookahead})}play(){this.isPlaying=!0,this.isPlaying&&(this.engine.current16thNote=0,this.engine.nextNoteTime=this.audioContext.currentTime,this.engine.nextNoteTime+=.01,this.timerWorker.postMessage("start"))}pause(){this.isPlaying=!1,this.isPlaying||(this.timerWorker.postMessage("stop"),this.timerWorker.postMessage({interval:0}))}}const S=new T})()})();